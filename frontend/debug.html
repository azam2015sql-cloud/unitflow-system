<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>فحص المستخدمين - UnitFlow</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div class="center-frame">
        <div class="login-container">
            <h1>فحص المستخدمين</h1>
            <p class="text-center text-secondary mb-3">للتطوير فقط</p>
            
            <button onclick="loadUsers()" class="btn btn-primary">تحميل المستخدمين</button>
            <button onclick="resetPasswords()" class="btn btn-success">إعادة تعيين كلمات المرور</button>
            
            <div id="usersList" class="mt-3"></div>
            <div id="message" class="mt-3"></div>
        </div>
    </div>

    <script src="db.js"></script>
    <script>
        async function loadUsers() {
            try {
                const response = await fetch('http://localhost:3000/api/debug/users');
                const users = await response.json();
                
                const container = document.getElementById('usersList');
                let html = '<h3>المستخدمون في قاعدة البيانات:</h3>';
                
                users.forEach(user => {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #dee2e6;">
                            <strong>ID:</strong> ${user.id}<br>
                            <strong>الاسم:</strong> ${user.name}<br>
                            <strong>اسم المستخدم:</strong> ${user.username}<br>
                            <strong>القسم:</strong> ${user.department}<br>
                            <strong>صفحة العمل:</strong> ${user.work_page}<br>
                            <strong>كلمة المرور:</strong> ${user.password}<br>
                            <strong>طول كلمة المرور:</strong> ${user.password.length} حرف
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = '<p style="color: red;">خطأ في تحميل المستخدمين</p>';
            }
        }
        
        async function resetPasswords() {
            try {
                const response = await fetch('http://localhost:3000/api/debug/reset-passwords', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('message').innerHTML = `
                        <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; border: 1px solid #c3e6cb;">
                            ${result.message}
                        </div>
                    `;
                } else {
                    document.getElementById('message').innerHTML = `
                        <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; border: 1px solid #f5c6cb;">
                            خطأ: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error resetting passwords:', error);
                document.getElementById('message').innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; border: 1px solid #f5c6cb;">
                        خطأ في إعادة تعيين كلمات المرور
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
